---
title: "Cloudflare Workers"
---

On this page, we explain how to use Upstash Workflow with Cloudflare Workers.

You can find [a complete Cloudflare Worker example in the sdk repository](https://github.com/upstash/qstash-js/tree/main/examples/workflow/cloudflare-workers). You can also find [a Cloudflare Worker example using Hono router](https://github.com/upstash/qstash-js/tree/main/examples/workflow/cloudflare-workers-hono) under our examples.

<Tip href="/qstash/workflows/platforms/hono" >

If you are using Cloudflare Workers with Hono router, you should use the [`serve` method for Hono](/qstash/workflows/platforms/hono).

</Tip>

# 1. Setting up Your Project

First, you should start a project. You can learn more about [starting a Cloudflare Worker project in Cloudflare documentation](https://developers.cloudflare.com/workers/get-started/guide/). When prompted, you can pick "Hello World example" and "Hello World Worker" as starting point.

If you are prompted to pick a framework, you can pick `Bun`. If you wish to pick `Hono`, you can select `Hono` but please follow [the guide for Hono](/qstash/workflows/platforms/hono).

Once you initialize the project, you should run the following command to install QStash:

```
npm i @upstash/qstash
```

# 2. Local Development

To be able to run a workflow in a local project, you will need to start a local tunnel in order for QStash server to communicate with your application. [See the local development section to learn more](/qstash/workflows/howto/local-development).

# 3. Environment Variables

Until now, we have only set the `UPSTASH_WORKFLOW_URL` environment variable. Next, we should set the `UPSTASH_TOKEN` environment variable. You can get `UPSTASH_TOKEN` from [the Upstash Console](https://console.upstash.com/).

Optionally, you can also set `QSTASH_CURRENT_SIGNING_KEY` and `QSTASH_NEXT_SIGNING_KEY` environment variables. See ["Secure Endpoints" for more details](/qstash/workflows/howto/security).

For Cloudflare to detect these environment variables locally you should create a `.dev.vars` file and write the variables there:

```
# creates .dev.vars file
touch .dev.vars
```

Add the environment variables:

```
UPSTASH_WORKFLOW_URL="*****"
QSTASH_TOKEN="*****"
```

# 4. serve method

Next, we will define the `serve` method. Go to the `src/index.ts` file and add the workflow endpoint as:

```javascript
// src/index.ts
import { serve } from "@upstash/qstash/cloudflare";

export default {
  fetch: serve<{text: string}>(async context => {
    // ...
  })
};
```

See [the documentation of the `serve` method for more details](/qstash/workflows/basics/serve).

# 5. Run Locally

Finally, we can run the project locally. Simply run:

```
npm run dev
```

To trigger the endpoint, you can run:

```
curl -X POST <DEV-URL> -d '{"text": "hello world!"}'
```

Note that if you set environment variables `QSTASH_CURRENT_SIGNING_KEY` and `QSTASH_NEXT_SIGNING_KEY`; your curl request with fail since the endpoint only accepts requests coming from QStash. [See "Secure Endpoints" for how you can call these endpoints](/qstash/workflows/howto/security).

# 6. deploy

To deploy the application, you should first deploy the project with:

```
npm run deploy
```

First time you deploy the app, it won't run since required env variables are missing.

Next, [add environment variables to your project](https://developers.cloudflare.com/workers/configuration/environment-variables/). You should add all environment variables you added to `.dev.vars`, except `UPSTASH_WORKFLOW_URL`.

You can run `npm run deploy` again to start your project with the environment variables.

Once the app is deployed, you can call it similar to how we called the development project:

```
curl -X POST <DEPLOYMENT-URL> -d '{"text": "hello world!"}'
```

Again, if you secured your endpoint with signing keys, you should refer to ["Secure Endpoints" page](/qstash/workflows/howto/security).

You can check [the monitoring pag to learn more about how you can monitor your workflows](/qstash/workflows/howto/monitor).
